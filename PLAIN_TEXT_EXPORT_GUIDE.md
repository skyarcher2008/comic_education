# 自动文本保存功能说明

## 功能概述

新增的**自动文本保存**功能可以在每次翻译完成后，自动将所有图片中检测到的原文和译文保存为纯文本文件到项目的`data/output/`目录中，并标记每张图片的页码信息。

## 功能特点

1. **自动触发**：翻译完成后自动保存，无需手动操作
2. **本地保存**：文件保存在项目目录的`data/output/`文件夹中
3. **页码标记**：每张图片都会标记为"第X页"，如果有文件名还会显示文件名
4. **原文译文对照**：每个文本气泡都会显示"原文 → 译文"的格式
5. **统计信息**：文件末尾包含导出统计（图片数量、文本气泡数量、导出时间）
6. **时间戳文件名**：自动生成带时间戳的文件名，避免覆盖

## 文件保存位置

- **保存目录**：`项目根目录/data/output/`
- **文件名格式**：`comic_text_2025-06-21_14-30-00.txt`
- **编码格式**：UTF-8（确保中文显示正常）

## 使用方法

1. 正常使用翻译功能，上传图片并进行翻译
2. 翻译完成后，系统会自动保存文本文件
3. 在界面右上角会显示保存成功的提示消息
4. 可以在`data/output/`目录中找到保存的文件

## 输出格式示例

```
漫画文本导出
==================================================

第1页 (page1.jpg)
-------------------
1. Hello
   → 你好

2. World
   → 世界

3. This is a test
   → 这是一个测试


第2页 (page2.png)
-------------------
1. Good morning
   → 早上好

2. How are you?
   → 你好吗？


第3页 (page3.jpg)
-------------------
1. Empty page
   → （未翻译）


==================================================
导出统计：共 3 张图片，6 个文本气泡
导出时间：2025/6/21 14:30:00
```

## 双重导出方式

现在提供两种文本导出方式：

### 1. 自动保存（新功能）
- **触发时机**：翻译完成后自动执行
- **保存位置**：项目目录 `data/output/`
- **优点**：无需手动操作，自动备份

### 2. 手动导出（原有功能）
- **触发方式**：点击"导出纯文本"按钮
- **保存位置**：浏览器下载目录
- **优点**：可随时导出，灵活控制

## 技术实现

### 前端修改
1. **自动保存函数**：在`main.js`中新增`autoSaveTextFile()`函数
2. **翻译完成钩子**：在批量翻译完成后自动调用保存函数
3. **API调用**：在`api.js`中新增`saveTextFileApi()`函数

### 后端修改
1. **新API端点**：在`system_api.py`中添加`/api/save_text_file`路由
2. **文件保存逻辑**：自动创建输出目录并保存文件
3. **错误处理**：完善的异常处理和日志记录

## 文件修改清单

1. `src/app/api/system_api.py` - 添加保存文本文件的API端点
2. `src/app/static/js/api.js` - 添加`saveTextFileApi()`函数
3. `src/app/static/js/main.js` - 添加`autoSaveTextFile()`函数和自动调用逻辑
4. `data/output/` - 新建输出目录

## 注意事项

- 只有包含文本内容的翻译才会触发自动保存
- 如果没有检测到任何文本，不会创建文件
- 每次翻译完成都会创建新文件，不会覆盖旧文件
- 文件使用UTF-8编码，确保中文显示正常
- 保存失败时会在控制台显示错误信息，但不影响正常翻译流程
